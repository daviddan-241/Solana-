<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Send SOL (open in Phantom)</title>
  <style>
    body {
      font-family: system-ui, Segoe UI, Roboto, Arial;
      max-width: 640px;
      margin: 40px auto;
      padding: 12px;
      background-color: #121212;
      color: #e0e0e0;
    }
    
    h2 {
      color: #ffffff;
    }
    
    label {
      display: block;
      margin: 12px 0 6px;
      color: #b0b0b0;
    }
    
    input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #2d2d2d;
      color: #e0e0e0;
      border: 1px solid #444;
      border-radius: 4px;
      box-sizing: border-box;
    }
    
    input:focus {
      outline: none;
      border-color: #8a2be2;
      box-shadow: 0 0 0 2px rgba(138, 43, 226, 0.2);
    }
    
    input::placeholder {
      color: #888;
    }
    
    button {
      margin-top: 14px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      background-color: #8a2be2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #7a1bd2;
    }
    
    button:active {
      background-color: #6a0bc2;
    }
    
    .hint {
      font-size: 13px;
      color: #aaa;
      margin-top: 8px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <h2>Send SOL — Open in Phantom (direct entry)</h2>

  <label for="recipient">Recipient address (paste base58 public key)</label>
  <input id="recipient" placeholder="Enter recipient public key (no spaces)" inputmode="text" />

  <label for="amount">Amount (SOL)</label>
  <input id="amount" placeholder="Enter amount, e.g. 0.25" inputmode="decimal" />

  <label for="label">Label (optional)</label>
  <input id="label" placeholder="e.g. 'Payment for item #123' (optional)" />

  <label for="memo">Memo (optional)</label>
  <input id="memo" placeholder="Short memo (optional)" />

  <button id="openWallet">Open in Wallet</button>

  <p class="hint">
    This will try to open the mobile wallet via the Solana Pay URL (solana:&lt;recipient&gt;?amount=...). If the user has Phantom installed it should open Phantom and prefill the send. If not, the browser may show an error or do nothing.
  </p>

  <script>
    // Function to get URL parameters
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        recipient: params.get('recipient') || params.get('address') || '',
        amount: params.get('amount') || params.get('sol') || '',
        label: params.get('label') || '',
        memo: params.get('memo') || ''
      };
    }

    // Pre-fill form fields from URL parameters
    function prefillFromUrl() {
      const urlParams = getUrlParams();
      
      if (urlParams.recipient) {
        document.getElementById('recipient').value = urlParams.recipient;
      }
      
      if (urlParams.amount) {
        document.getElementById('amount').value = urlParams.amount;
      }
      
      if (urlParams.label) {
        document.getElementById('label').value = urlParams.label;
      }
      
      if (urlParams.memo) {
        document.getElementById('memo').value = urlParams.memo;
      }
    }

    // Initialize form with URL parameters
    document.addEventListener('DOMContentLoaded', prefillFromUrl);

    function isValidBase58(s){
      // light sanity check: base58 characters (no strict cryptographic check)
      return /^[1-9A-HJ-NP-Za-km-z]{32,}$/u.test(s.trim());
    }

    function buildSolanaUrl(recipient, amount, label, memo){
      // Build a Solana Pay transfer URL: solana:<recipient>?amount=<amount>&label=...&memo=...
      // Note: amount must be a decimal (SOL). We URL-encode optional params.
      const params = new URLSearchParams();
      if (amount) params.set('amount', amount);
      if (label)  params.set('label', label);
      if (memo)   params.set('memo', memo);
      return `solana:${recipient}?${params.toString()}`;
    }

    document.getElementById('openWallet').addEventListener('click', function(e){
      const recipient = document.getElementById('recipient').value.trim();
      const amount = document.getElementById('amount').value.trim();
      const label = document.getElementById('label').value.trim();
      const memo = document.getElementById('memo').value.trim();

      if (!recipient){
        alert('Please enter a recipient public key.');
        return;
      }
      if (!isValidBase58(recipient)){
        if(!confirm('Recipient looks unusual. Continue anyway?')) return;
      }
      if (amount && Number.isNaN(Number(amount))){
        alert('Amount must be a number (e.g. 0.6).');
        return;
      }

      const url = buildSolanaUrl(recipient, amount, label, memo);

      // Try to open the solana:// URI (wallet handles it).
      // On mobile browsers this will open the installed wallet app (if it supports solana: URIs).
      window.location.href = url;

      // Optional fallback: after a brief delay, open Phantom universal link page
      // (useful if the solana: scheme isn't handled — comment this block out if you don't want any fallback)
      setTimeout(() => {
        // NOTE: we don't include recipient/amount here to avoid hard-coding; this just opens Phantom homepage.
        // If you prefer a wallet selection page or store-specific flow, you can use phantom.app links per Phantom docs.
        window.open('https://phantom.app/', '_blank');
      }, 1200);
    });
  </script>
</body>
</html> 
